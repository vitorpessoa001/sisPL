<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Assessoria - Selecionar Data</title>
  <link rel="icon" href="{{ url_for('static', filename='favicon.ico') }}">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
  <style>
    body {
      background: #f8f9fa;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      font-size: 0.95rem;
    }
    .header {
      background: linear-gradient(135deg, #006633 0%, #008040 100%);
      color: #fff;
      padding: 0.75rem 0;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    }
    .header-wrap {
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    .header-logos {
      display: flex;
      flex-direction: column;
      align-items: center;
      margin-right: 1rem;
    }
    .logo { width: 80px; height: auto; }
    .logo-pl { height: 45px; opacity: 0.9; }
    .titulo-app {
      font-size: 1.4rem;
      font-weight: 700;
      margin: 0;
    }
    .subtitulo-app {
      font-size: 0.9rem;
      margin: 0;
      opacity: 0.9;
    }

    /* --- Conteúdo --- */
    h5 { font-weight: 600; color: #004d26; }
    .event-card {
      border-left: 4px solid #006633;
      background: #ffffff;
      box-shadow: 0 2px 4px rgba(0,0,0,0.05);
      border-radius: 6px;
      transition: all 0.2s ease-in-out;
    }
    .event-card:hover {
      transform: translateY(-3px);
      box-shadow: 0 4px 8px rgba(0,0,0,0.08);
    }
    .event-card h6 {
      font-weight: 700;
      color: #006633;
      margin-bottom: 0.3rem;
    }
    .event-card p {
      margin: 0;
      line-height: 1.4;
    }
    .event-card .btn {
      background-color: #006633;
      border: none;
    }
    .event-card .btn:hover {
      background-color: #004d26;
    }

    .badge {
      font-size: 0.75rem;
      padding: 0.4em 0.6em;
      border-radius: 0.4rem;
      vertical-align: middle;
    }

    .count-info {
      background: #eaf3ee;
      border: 1px solid #c8e0d0;
      border-radius: 6px;
      padding: 0.6rem 1rem;
      font-size: 0.9rem;
      color: #004d26;
      margin-top: 1rem;
    }

    .data-input-container {
      display: flex;
      align-items: end;
      gap: 10px;
      max-width: 400px;
    }

    .spinner-container {
      display: none;
      text-align: center;
      margin-top: 2rem;
    }

    @media (max-width: 768px) {
      .header-wrap { flex-direction: column; text-align: center; }
      .header-logos { margin: 0 0 0.5rem 0; }
      .data-input-container { flex-direction: column; align-items: start; }
    }
  </style>
</head>

<body>
  <!-- Cabeçalho -->
  <div class="header">
    <div class="container header-wrap">
      <div class="d-flex align-items-center">
        <div class="header-logos me-3">
          <img src="/static/logo_camara.png" alt="Logo da Câmara" class="logo">
          <img src="/static/logo_pl.png" alt="Logo do PL" class="logo-pl mt-2">
        </div>
        <div>
          <h1 class="titulo-app mb-0">Assessoria</h1>
          <p class="subtitulo-app mb-0">Plenário da Câmara dos Deputados</p>
        </div>
      </div>
      <div class="text-end">
        <a href="{{ url_for('usuarios.logout') }}" class="btn btn-outline-light btn-sm mb-1">
          <i class="fas fa-sign-out-alt me-2"></i>Sair
        </a><br>

        <small class="text-light">{{ current_user.username }}</small>
        {% if current_user.is_authenticated and current_user.role == 'Admin' %}
          <a href="{{ url_for('usuarios.admin_usuarios') }}" 
            class="btn btn-sm mb-1 ms-1" 
            style="color:#e5e5e5; border:none; background:transparent;">
            <i class="fas fa-cog"></i>
          </a>
        {% endif %}
</div>
    </div>
  </div>

  <!-- Conteúdo -->
  <div class="container my-4">
    <h5><i class="fas fa-calendar-day me-2"></i>Selecione a Data da Sessão</h5>
    <form method="POST" action="{{ url_for('selecionar_data') }}" id="formData" class="mb-4">
      <div class="data-input-container">
        <div class="col-auto">
          <label for="data" class="form-label text-muted">Data</label>
          <input type="date" class="form-control" id="data" name="data" value="{{ data_selecionada }}" required>
        </div>
        <div class="col-auto">
          <button type="button" id="botao-hoje" class="btn btn-outline-primary btn-sm">
            <i class="fas fa-calendar-day me-1"></i>Hoje
          </button>
        </div>
      </div>
    </form>

    <!-- Spinner de carregamento -->
    <div id="spinner-container" class="spinner-container">
      <div class="spinner-border text-primary" role="status">
        <span class="visually-hidden">Carregando...</span>
      </div>
      <p class="mt-2">Carregando...</p>
    </div>

    <!-- Eventos -->
    <div id="eventos-container">
      {% if eventos %}
        <div class="count-info">
          <i class="fas fa-check-circle me-2 text-success"></i>
          <strong>{{ eventos|length }}</strong>
          sessão{{ 's' if eventos|length > 1 else '' }} deliberativa{{ 's' if eventos|length > 1 else '' }} encontrada{{ 's' if eventos|length > 1 else '' }}
          para {{ data_selecionada | datetimeformat('%d/%m/%Y') }}.
        </div>

        <h5 class="mt-4"><i class="fas fa-list me-2"></i>Sessões Deliberativas Encontradas</h5>
        {% for evento in eventos %}
          <div class="event-card p-3 mb-3">
            <div class="d-flex justify-content-between align-items-center mb-1">
              <h6 class="mb-0"><i class="fas fa-users me-2"></i>Sessão Deliberativa</h6>
              <span class="badge 
                {% if evento.situacao and 'andamento' in evento.situacao.lower() %}bg-success
                {% elif evento.situacao and 'convocada' in evento.situacao.lower() %}bg-warning text-dark
                {% elif evento.situacao and 'encerrada' in evento.situacao.lower() %}bg-secondary
                {% else %}bg-light text-dark{% endif %}">
                {{ evento.situacao | default('N/D') }}
              </span>
            </div>
            <p class="small text-muted mt-1">
              <strong><i class="fas fa-hashtag me-1"></i>ID:</strong> {{ evento.id }}<br>
              <strong><i class="far fa-clock me-1"></i>Data/Hora:</strong>
              {{ evento.dataHoraInicio | default('N/D') | replace('T', ' ') | datetimeformat('%d/%m/%Y %H:%M') if evento.dataHoraInicio != 'N/D' else 'N/D' }}<br>
              <strong><i class="fas fa-info-circle me-1"></i>Descrição:</strong> {{ evento.descricao }}<br>
              <strong><i class="fas fa-map-marker-alt me-1"></i>Local:</strong> {{ evento.local }}
            </p>
            <div class="mt-2">
              <a href="{{ url_for('view_pauta', evento_id=evento.id) }}" class="btn btn-success btn-sm ver-pauta">
                <i class="fas fa-list me-2"></i>Ver Pauta
              </a>
            </div>
          </div>
        {% endfor %}
      {% elif data_selecionada %}
        <div class="alert alert-info mt-4">
          Nenhuma sessão deliberativa encontrada para {{ data_selecionada | datetimeformat('%d/%m/%Y') }}.
        </div>
      {% endif %}
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const dataInput = document.getElementById('data');
      const formData = document.getElementById('formData');
      const eventosContainer = document.getElementById('eventos-container');
      const spinnerContainer = document.getElementById('spinner-container');

      // Envia o formulário automaticamente ao alterar a data, com spinner
      dataInput.addEventListener('change', function() {
        eventosContainer.style.display = 'none';
        spinnerContainer.style.display = 'block';
        // Envia o formulário após um pequeno delay para garantir que o spinner apareça
        setTimeout(() => {
          formData.submit();
        }, 100);
      });

      // Lógica do botão "Hoje" (usa a data real do sistema)
      document.getElementById('botao-hoje').addEventListener('click', () => {
        const hoje = new Date();
        const ano = hoje.getFullYear();
        const mes = String(hoje.getMonth() + 1).padStart(2, '0');
        const dia = String(hoje.getDate()).padStart(2, '0');
        const dataFormatada = `${ano}-${mes}-${dia}`;

        dataInput.value = dataFormatada;
        eventosContainer.style.display = 'none';
        spinnerContainer.style.display = 'block';

        setTimeout(() => {
          formData.submit();
        }, 100);
      });


      // Lógica do spinner ao clicar em "Ver Pauta"
      document.querySelectorAll('.ver-pauta').forEach(btn => {
        btn.addEventListener('click', (e) => {
          e.preventDefault();
          eventosContainer.style.display = 'none';
          spinnerContainer.style.display = 'block';
          // Redireciona após um pequeno delay para mostrar o spinner
          setTimeout(() => {
            window.location.href = btn.href;
          }, 100);
        });
      });
    });
  </script>
</body>
</html>